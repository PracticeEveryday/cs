## Handshake

ì»´í“¨í„°ì—ì„œ `Handshake`ëŠ” ì¸ì¦, ì¡°ì •ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë‘ ì¥ì¹˜, í”„ë¡œê·¸ë¨ ê°„ì˜ ì‹ í˜¸(signal)ì´ë‹¤.   
ë„¤íŠ¸ì›Œí¬ ìƒì—ì„œ ì „ì²´ í†µì‹ ì´ ì‹œì‘ë˜ê¸° ì „ ë™ì‹  ë§í¬ì˜ `í”„ë¡œí† ì½œ ì„¤ì •`ì„ êµí™˜í•˜ì—¬ ë‘ ì°¸ê°€ì ê°„ì˜ ìë™í™”ëœ í˜‘ìƒ í”„ë¡œì„¸ìŠ¤ì´ë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ `Handshake Process`ëŠ” ì„œë¡œ ë‹¤ë¥¸ ì¥ì¹˜ ê°„ í†µì‹ ì„ ì‹œë„í•  ë•Œ Protocol, í†µì‹  ê·œì¹™ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ ì£¼ê³  ë°›ëŠ” ê³¼ì •ì´ë‹¤.   

Ex) ğŸ“Œ ì˜ˆë¥¼ ë“¤ì–´, ì»´í“¨í„°ì™€ ëª¨ë€ê°„ ë‹¤ë¥¸ ì¥ì¹˜ê°€ í†µì‹ í•  ë•Œ ìŠ¤ìœ„í‚¤ê°€ ì¼œì ¸ ìˆìŒê³¼ ê°™ì€ ì¤€ë¹„ê°€ ë˜ì—ˆìŒ + ì‚¬ìš© ì¤‘ì¸ í”„ë¡œí† ì½œì— ë™ì˜í•¨ì„ Handshake ê³¼ì •ì—ì„œ ë‚˜ëˆˆë‹¤.

ê°„ë‹¨í•œ Handshaking Protocolì€ `ë§ˆì§€ë§‰ ë©”ì‹œì§€ ì˜ ë°›ì•˜ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë©”ì‹œì§€ ë³´ë‚¼ ì¤€ë¹„ë„ ë˜ì—ˆìŠµë‹ˆë‹¤.`ë¡œ ëë‚¼ ìˆ˜ë„ ìˆë‹¤.   
ì¡°ê¸ˆ ë” ë³µì¡í•œ Handshaking Protocolì€ `ë§ˆì§€ë§‰ ë©”ì‹œì§€ë¥¼ ì œëŒ€ë¡œ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`ì™€ ê°™ì€ ë¶€ì • ìŠ¹ì¸ë„ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.

Handshakingì€ ë§¤ê°œ ë³€ìˆ˜ë“¤ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ ì‚¬ëŒì´ ê°œì…ë˜ì§€ ì•Šê³  ì´ì§ˆì ì¸ ì‹œìŠ¤í…œê³¼ ì¥ë¹„ë“¤ì„ ì‰½ê²Œ ì—°ê²° í•  ìˆ˜ ìˆë‹¤.

> ëª¨ë“  `Protocol`ì´ Handshake ë¼ëŠ” ìš©ì–´ë¥¼ ì‚¬ìš©í• ê¹Œ?
> 
> FTP, SMTPê°™ì€ í”„ë¡œí† ì½œì—ëŠ” Handshakeë¼ëŠ” ìš©ì–´ ëŒ€ì‹  `conversation`ì´ë¼ëŠ” ìš©ì–´ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•œë‹¤.

### 3-way handshake

`three-way handshake`ëŠ” ì»´í“¨í„° ë„¤íŠ¸ì›Œí¬ ì—ì„œ TCP/IP í†µì‹  Protocolì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì—°ê²°ì„ ì„¤ì •í•˜ëŠ” ê¸°ë³¸ í”„ë¡œì„¸ìŠ¤ì´ë‹¤.   
ë°ì´í„° ì „ì†¡ì´ ì‹œì‘ë˜ê¸° ì „ì— ì„œë²„ ê°„ì— ì—°ê²°ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ TCP(Transmission Control Protocol)ì—ì„œ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì´ë‹¤.      
ì´ `three-way handshake`ê°€ ì •ìƒì ìœ¼ë¡œ ì—°ê²° ë˜ë©´ `í†µì‹  ì¤€ë¹„`ê°€ ì™„ë£Œ ëœë‹¤!

### Segment(ì¡°ê°)

SegmentëŠ” ì „ì†¡ ê³„ì¸µì—ì„œ TCP í”„ë¡œí† ì½œì„ í™œìš©í•  ë–„ ì‚¬ìš©ë˜ëŠ” ë°ì´í„° ë‹¨ìœ„ì´ë‹¤.   
TCPëŠ” ìƒìœ„ ìŠ¤íŠ¸ë¦¼ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ ë“¤ì—¬ ì²­í¬ë¡œ ë‚˜ëˆˆ ë’¤ `TCP ì„¸ê·¸ë¨¼íŠ¸`ë¥¼ ìƒì„±í•œë‹¤.   

> í”„ë¡œì„¸ìŠ¤ëŠ” TCPë¥¼ í˜¸ì¶œí•œ ë’¤ â¡ï¸ ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•œë‹¤.
> 
> TCPëŠ” ë²„í¼ ë°ì´í„°ë¥¼ ì„¸ê·¸ë¨¼íŠ¸ë¡œ íŒ¨í‚¤ì§•í•˜ê³  Internet ëª¨ë“ˆ(IP)ì„ í˜¸ì¶œí•˜ê³  ê° ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ì „ì†¡í•œë‹¤.

#### Segment êµ¬ì¡°
`Segment`ëŠ” `í—¤ë”`ì™€ `ë°ì´í„°` ì„¹ì…˜ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.   

Segment HeaderëŠ” 10ê°œì˜ í•„ìˆ˜ í•„ë“œì™€ Optionalì˜ í™•ì¥ í•„ë“œë¥¼ ê°€ì§„ë‹¤.   
ë°ì´í„° ì„¹ì…˜ì€ Header Section ë‹¤ìŒì— ë‚˜ì˜¤ë©° ë‹¤ë¥¸ Appì— ì „ë‹¬ë˜ëŠ” ë°ì´í„°ì´ë‹¤.

> Segment Header

![image](https://github.com/user-attachments/assets/d2e59bae-73a2-4ad1-b660-891381632f1f)

## TCP í—¤ë” í•„ë“œ êµ¬ì„±

1. **Source Port (16 bits)**
    - ë°œì‹ ì§€ í¬íŠ¸ ë²ˆí˜¸.

2. **Destination Port (16 bits)**
    - ìˆ˜ì‹ ì§€ í¬íŠ¸ ë²ˆí˜¸.

3. **Sequence Number (32 bits)**
    - ì‹œí€€ìŠ¤ ë²ˆí˜¸.
    - **SYN í”Œë˜ê·¸ê°€ ì„¤ì •ëœ ê²½ìš°:**
        - ì´ˆê¸° ì‹œí€€ìŠ¤ ë²ˆí˜¸.
    - **SYN í”Œë˜ê·¸ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°:**
        - í˜„ì¬ ì„¸ì…˜ì˜ ì²« ë²ˆì§¸ ë°ì´í„° ë°”ì´íŠ¸ì˜ ëˆ„ì  ì‹œí€€ìŠ¤ ë²ˆí˜¸.

4. **Acknowledgement Number (32 bits)**
    - ACK ë²ˆí˜¸.
    - **ACK í”Œë˜ê·¸ê°€ ì„¤ì •ëœ ê²½ìš°:**
        - ë°œì‹ ìê°€ ì˜ˆìƒí•˜ëŠ” ë‹¤ìŒ ì‹œí€€ìŠ¤ ë²ˆí˜¸.
        - ì´ì „ ë°”ì´íŠ¸ì˜ ìˆ˜ì‹ ì„ ì¸ì •.

5. **Data Offset (4 bits)**
    - TCP í—¤ë”ì˜ ê¸¸ì´ë¥¼ 32ë¹„íŠ¸ ì›Œë“œ ë‹¨ìœ„ë¡œ í‘œì‹œ.

6. **Reserved (4 bits)**
    - ì˜ˆì•½ í•„ë“œ. í˜„ì¬ëŠ” 0ìœ¼ë¡œ ì„¤ì •.
    - ë‚˜ì¤‘ì— ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì˜ˆì•½ë¨. ë°œì‹ ìëŠ” ì´ í•„ë“œë¥¼ ì„¤ì •í•  ìˆ˜ ì—†ìœ¼ë©°, ìˆ˜ì‹ ìëŠ” íŠ¹ë³„í•œ ì§€ì •ì´ ì—†ëŠ” ê²½ìš° ë¬´ì‹œí•¨.

7. **Flags (8 bits)**
    - **CWR (1 bit):** í˜¼ì¡ ìœˆë„ìš° ê°ì†Œ ì‹ í˜¸.
    - **ECE (1 bit):** í˜¼ì¡ íƒì§€ ì‹ í˜¸.
    - **URG (1 bit):** ê¸´ê¸‰ ì—¬ë¶€.
    - **ACK (1 bit):** ìŠ¹ì¸ í•„ë“œ (SYN íŒ¨í‚· ì´í›„ ëª¨ë“  íŒ¨í‚·ì—ì„œ ì„¤ì •ë¨).
    - **PSH (1 bit):** í‘¸ì‹œ í”Œë˜ê·¸.
    - **RST (1 bit):** ì—°ê²° ì¬ì„¤ì • ì—¬ë¶€.
    - **SYN (1 bit):** ì‹œí€€ìŠ¤ ë²ˆí˜¸ ë™ê¸°í™” ì—¬ë¶€.
    - **FIN (1 bit):** ë³´ë‚¸ ì‚¬ëŒì˜ ë§ˆì§€ë§‰ íŒ¨í‚· ì—¬ë¶€.

8. **Window Size (16 bits)**
    - ìˆ˜ì‹ ìê°€ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ì˜ í¬ê¸°.

9. **Checksum (16 bits)**
    - TCP í—¤ë”ì™€ í˜ì´ë¡œë“œì˜ ì˜¤ë¥˜ ê²€ì‚¬ë¥¼ ìœ„í•œ í•„ë“œ.

10. **Urgent Pointer (16 bits)**
    - **URG í”Œë˜ê·¸ê°€ ì„¤ì •ëœ ê²½ìš°:**
        - ê¸´ê¸‰ ë°ì´í„°ì˜ ë§ˆì§€ë§‰ ë°”ì´íŠ¸ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì‹œí€€ìŠ¤ ë²ˆí˜¸ ì˜¤í”„ì…‹.

11. **Options (0-320 bits, 32-bit ë‹¨ìœ„)**
    - ì¶”ê°€ì ì¸ ì˜µì…˜ í•„ë“œ. í•„ìš”ì— ë”°ë¼ 32ë¹„íŠ¸ ë‹¨ìœ„ë¡œ í™•ì¥ ê°€ëŠ¥.


> ğŸ¤” Sequence Number(ì—°ì†ì ì¸ ìˆ«ì)
> 
> TCPì—ì„œëŠ” ë°ì´í„°ë¥¼ `Byte Stream` í˜•ì‹ìœ¼ë¡œ ë³¸ë‹¤. << `Process`ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë°ì´í„° í˜•ì‹ ì´ë¦„ì„ Stream ì´ë¼ê³  í•œë‹¤.   
> Sequence NumberëŠ” ì„¸ê·¸ë¨¼íŠ¸ì˜ í˜ì´ë¡œë“œì— ìˆëŠ” ì²« ë²ˆì§¸ ë°”ì´íŠ¸ì˜ ìŠ¤íŠ¸ë¦¼ ë²ˆí˜¸ì´ë‹¤.   
> 
> ë³´ë‚´ì•¼ í•  ë°ì´í„° í¬ê¸°ê°€ 500,000bytes ì´ê³  ì„¸ê·¸ë¨¼íŠ¸ì— 1000Bytes ë§Œ ë‹´ì„ ìˆ˜ ìˆì„ ê²½ìš°   
> ì²« ë²ˆì§¸ ì„¸ê·¸ë¨¼íŠ¸ì˜ Sequence NumberëŠ” 0 -> 1000 -> 2000... ìˆœìœ¼ë¡œ ê°€ê²Œ ëœë‹¤.


> ğŸ¤” Acknowledge Number(ë°›ì•˜ìŒì„ ì•Œë¦¬ëŠ” ìˆ«ì)
> 
> Acknowledge NumberëŠ” Sequence Numberì— ëŒ€ì‘í•˜ê¸° ìœ„í•œ ë²ˆí˜¸ì´ë‹¤.   
> Aê°€ Bì—ê²Œ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ë°›ì•˜ì„ ë•Œ ì „ë‹¬ ë°›ì€ ë§ˆì§€ë§‰ Sequence Numberì˜ ë‹¤ìŒ ë°”ì´íŠ¸ì— í•´ë‹¹í•˜ëŠ” ê°’ì„ ë„£ì–´ì¤€ë‹¤.   
> 
> ì¦‰, 1000ë²ˆê¹Œì§€ì˜ ë°”ì´íŠ¸ë¥¼ ë°›ì•˜ë‹¤ë©´ Acknowledge Numberì— 10001ì„ ë„£ì–´ ë³´ë‚¸ë‹¤.
 

> AckëŠ” Feedbackì˜ ì—­í• ë„ ìˆ˜í–‰í•œë‹¤.
> 
> TCPëŠ” ë°ì´í„° íŒ¨í‚·ì„ ì£¼ê³  ë°›ëŠ” ê³¼ì •ì—ì„œ `ìˆ˜ì‹ ì`ëŠ” ê²°ê³¼ë¥¼ í”¼ë“œë°± í•œë‹¤ëŠ” ì›ì¹™ì„ ë”°ë¥´ëŠ”ë°   
> ì´ ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ACKë¡œ TCP í†µì‹ ì—ì„œ ë°ì´í„° íŒ¨í‚·ì„ ì„±ê³µì ìœ¼ë¡œ ë°›ì•˜ë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì£¼ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì‹ í˜¸ë‹¤!


### ë°ì´í„° ì†¡ì‹  ì˜ˆì‹œ

![image](https://github.com/user-attachments/assets/30f72f24-eb86-4e93-a1fd-b3bc213dd4d8)

1. Seq(Sequence Number)

`ì†¡ì‹ ì`ê°€ ë³´ë‚¸ ë°ì´í„°ì˜ ìˆœì„œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ê° ë°”ì´íŠ¸ ë°ì´í„°ì—ëŠ” ê³ ìœ í•œ ì‹œí€€ìŠ¤ ë²ˆí˜¸ê°€ ë¶™ëŠ”ë‹¤

2. ACK(Acknowledgment Number) + Feedback

`ìˆ˜ì‹ ì`ê°€ ë‹¤ìŒì— ë°›ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒí•˜ëŠ” ë°ì´í„°ì˜ ì‹œí€€ìŠ¤ ë²ˆí˜¸ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.   
`ì§€ê¸ˆê¹Œì§€ ë°›ì€ ë°ì´í„°ëŠ” ì´ ì‹œí€€ìŠ¤ ë²ˆí˜¸ê¹Œì§€ ì…ë‹ˆë‹¤.`ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

`ACK` ìˆ«ìëŠ” `SEQ + ë°ì´í„° í¬ê¸° + 1` ê·œì¹™ì„ ë”°ë¥¸ë‹¤.   

> ğŸ’¡ì‹¤ì œë¡œ TCP í†µì‹ ì—ì„œëŠ” ìœ„ì™€ ê°™ì´ `ì†¡ìˆ˜ì‹ ì`ê°€ ëšœë ·í•˜ê²Œ ë‚˜ëˆ„ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤.

ì¦‰, ì¼ë°©ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ê¸°ë§Œ í•˜ëŠ” ë…¸ë“œì™€ ë°›ê¸°ë§Œ í•˜ëŠ” ë…¸ë“œê°€ ëª…í™•í•˜ê²Œ ë‚˜ë‰˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.   
âœ… HTTP Client-Server í†µì‹ ì—ì„œ HTTP ìš”ì²­ ì‹œ í´ë¼ì´ì–¸íŠ¸ê°€ `ì†¡ì‹ ì`, ì„œë²„ëŠ” `ìˆ˜ì‹ ì`ê°€ ëœë‹¤.   
í•˜ì§€ë§Œ, ì„œë²„ì˜ ì‘ë‹µ ì‹œì ì—ì„œëŠ” ë°˜ëŒ€ë¡œ ì„œë²„ê°€ `ì†¡ì‹ ì`, í´ë¼ì´ì–¸íŠ¸ê°€ `ì†¡ì‹ ì`ê°€ ë˜ëŠ” ê²ƒì´ë‹¤!

![image](https://github.com/user-attachments/assets/35bd8298-8cea-4291-9818-10654b8ea3e2)

> ğŸ‘‰ ì˜ˆì‹œë¥¼ í•œ ë²ˆ ë³´ì

![image](https://github.com/user-attachments/assets/96e3e635-c2cd-4051-ae26-95fb884aa56e)

AëŠ” Bì—ê²Œ ì „ë‹¬ë°›ì€ ë§ˆì§€ë§‰ Ack ë²ˆí˜¸ 111ë¥¼ Seqì— ì €ì¥í•œë‹¤.(`ë‚´ê°€ ì£¼ì–´ì•¼ í•˜ëŠ” ì‹œì‘ Stream ìˆ«ìì´ë‹¤.`)   
AckëŠ” Bê°€ ì „ë‹¬í•œ Seq ê°’ 200ì— Byte í¬ê¸° 20ì™€ 1ì„ ë”í•œë‹¤ (200 + 20 + 1 = 221)

1. Seq: 111 < Bì—ê²Œ ì „ë‹¬ ë°›ì€ ë§ˆì§€ë§‰ Ack ë²ˆí˜¸(ì¦‰, ë‚´ê°€ ì¤˜ì•¼í•˜ëŠ” ì‹œì‘ Sequence Number)   
2. Ack: 221 < Aê°€ Bì—ê²Œ ì „ë‹¬ë°›ì•„ì•¼ í•˜ëŠ” ë‹¤ìŒ Seq ë²ˆí˜¸

BëŠ” Aì—ê²Œ ì „ë‹¬ë°›ì€ ë§ˆì§€ë§‰ Ack ë²ˆí˜¸ 221ì„ Seqì— ì €ì¥í•œë‹¤.(`ë‚´ê°€ ì£¼ì–´ì•¼ í•˜ëŠ” ì‹œì‘ Stream ìˆ«ìì´ë‹¤.`)   
AckëŠ” Aê°€ ì „ë‹¬í•œ Seq ê°’ 111ì— Byte í¬ê¸° 10ê³¼ 1ì„ ë”í•œë‹¤ (111 + 10 + 1 = 121)

1. Seq: 221 < Aì—ê²Œ ì „ë‹¬ ë°›ì€ ë§ˆì§€ë§‰ Ack ë²ˆí˜¸(ì¦‰, ë‚´ê°€ ì¤˜ì•¼í•˜ëŠ” ì‹œì‘ Sequence Number)
2. Ack: 122 < Aê°€ Bì—ê²Œ ì „ë‹¬ë°›ì•„ì•¼ í•˜ëŠ” ë‹¤ìŒ Seq ë²ˆí˜¸ 


ğŸ“í—·ê°ˆë¦´ ìˆ˜ ìˆì§€ë§Œ, ìƒëŒ€ë°©ì´ ì „ë‹¬ ë°›ì•„ì•¼ í•˜ëŠ” Ack ìˆ«ìëŠ” ë‚´ê°€ ì¤˜ì•¼í•˜ëŠ” Seq ìˆ«ìì™€ ë™ì¼í•œ ê²ƒë§Œ ìƒê°í•˜ë©´ í—·ê°ˆë¦´ ê²ƒì´ ëœí•  ê²ƒì´ë‹¤!


### ì°¸ê³  ìë£Œ
- [Handshake](https://en.wikipedia.org/wiki/Handshake_(computing))
- [TCP](https://en.wikipedia.org/wiki/Transmission_Control_Protocol)
- [[ë„¤íŠ¸ì›Œí¬] TCP-Segment Structure](https://hi-guten-tag.tistory.com/397)
- [TCPë€? (3-Way handshake, 4-Way hanshake)](https://steadiness.dev/tcp-basics/)